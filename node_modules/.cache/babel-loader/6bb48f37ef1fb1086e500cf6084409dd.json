{"ast":null,"code":"import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{ColorConverter}from'@nitrots/nitro-renderer';import{useMemo,useState}from'react';import{AutoGrid,Base,Button,Column,Flex,Grid,LayoutGridItem,Text}from'../../../../../common';import{useCatalog}from'../../../../../hooks';import{CatalogGridOfferView}from'../common/CatalogGridOfferView';import{CatalogAddOnBadgeWidgetView}from'../widgets/CatalogAddOnBadgeWidgetView';import{CatalogLimitedItemWidgetView}from'../widgets/CatalogLimitedItemWidgetView';import{CatalogPurchaseWidgetView}from'../widgets/CatalogPurchaseWidgetView';import{CatalogSpinnerWidgetView}from'../widgets/CatalogSpinnerWidgetView';import{CatalogTotalPriceWidget}from'../widgets/CatalogTotalPriceWidget';import{CatalogViewProductWidgetView}from'../widgets/CatalogViewProductWidgetView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export const CatalogLayoutColorGroupingView=props=>{const{page=null}=props;const[colorableItems,setColorableItems]=useState(new Map());const{currentOffer=null,setCurrentOffer=null}=useCatalog();const[colorsShowing,setColorsShowing]=useState(false);const sortByColorIndex=(a,b)=>{if(!a.product.furnitureData.colorIndex||!b.product.furnitureData.colorIndex){return 1;}if(a.product.furnitureData.colorIndex>b.product.furnitureData.colorIndex){return 1;}if(a==b){return 0;}return-1;};const sortyByFurnitureClassName=(a,b)=>{if(a.product.furnitureData.className>b.product.furnitureData.className){return 1;}if(a==b){return 0;}return-1;};const selectOffer=offer=>{offer.activate();setCurrentOffer(offer);};const selectColor=(colorIndex,productName)=>{const fullName=`${productName}*${colorIndex}`;const index=page.offers.findIndex(offer=>offer.product.furnitureData.fullName===fullName);if(index>-1){selectOffer(page.offers[index]);}};const offers=useMemo(()=>{const offers=[];const addedColorableItems=new Map();const updatedColorableItems=new Map();page.offers.sort(sortByColorIndex);let selectedColor=0;page.offers.forEach(offer=>{if(!offer.product)return;const furniData=offer.product.furnitureData;if(!furniData||!furniData.hasIndexedColor){offers.push(offer);}else{const name=furniData.className;const colorIndex=furniData.colorIndex;if(!updatedColorableItems.has(name)){updatedColorableItems.set(name,[]);}if(furniData.colors){for(let color of furniData.colors){if(color!==0xFFFFFF)// for some reason we hate the color white\n{selectedColor=color;}}if(updatedColorableItems.get(name).indexOf(selectedColor)===-1){updatedColorableItems.get(name)[colorIndex]=selectedColor;}}if(!addedColorableItems.has(name)){offers.push(offer);addedColorableItems.set(name,true);}}});offers.sort(sortyByFurnitureClassName);setColorableItems(updatedColorableItems);return offers;},[page.offers]);return/*#__PURE__*/_jsxs(Grid,{children:[/*#__PURE__*/_jsx(Column,{size:7,overflow:\"hidden\",children:/*#__PURE__*/_jsxs(AutoGrid,{columnCount:5,children:[(!colorsShowing||!currentOffer||!colorableItems.has(currentOffer.product.furnitureData.className))&&offers.map((offer,index)=>/*#__PURE__*/_jsx(CatalogGridOfferView,{itemActive:currentOffer&&(currentOffer.product.furnitureData.hasIndexedColor?currentOffer.product.furnitureData.className===offer.product.furnitureData.className:currentOffer.offerId===offer.offerId),offer:offer,selectOffer:selectOffer},index)),colorsShowing&&currentOffer&&colorableItems.has(currentOffer.product.furnitureData.className)&&colorableItems.get(currentOffer.product.furnitureData.className).map((color,index)=>/*#__PURE__*/_jsx(LayoutGridItem,{itemHighlight:true,itemActive:currentOffer.product.furnitureData.colorIndex===index,itemColor:ColorConverter.int2rgb(color),className:\"clear-bg\",onClick:event=>selectColor(index,currentOffer.product.furnitureData.className)},index))]})}),/*#__PURE__*/_jsxs(Column,{center:!currentOffer,size:5,overflow:\"hidden\",children:[!currentOffer&&/*#__PURE__*/_jsxs(_Fragment,{children:[!!page.localization.getImage(1)&&/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:page.localization.getImage(1)}),/*#__PURE__*/_jsx(Text,{center:true,dangerouslySetInnerHTML:{__html:page.localization.getText(0)}})]}),currentOffer&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Base,{position:\"relative\",overflow:\"hidden\",children:[/*#__PURE__*/_jsx(CatalogViewProductWidgetView,{}),/*#__PURE__*/_jsx(CatalogLimitedItemWidgetView,{fullWidth:true,position:\"absolute\",className:\"top-1\"}),/*#__PURE__*/_jsx(CatalogAddOnBadgeWidgetView,{position:\"absolute\",className:\"bg-muted rounded bottom-1 end-1\"}),currentOffer.product.furnitureData.hasIndexedColor&&/*#__PURE__*/_jsx(Button,{position:\"absolute\",className:\"bottom-1 start-1\",onClick:event=>setColorsShowing(prev=>!prev),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"fill-drip\"})})]}),/*#__PURE__*/_jsxs(Column,{grow:true,gap:1,children:[/*#__PURE__*/_jsx(Text,{grow:true,truncate:true,children:currentOffer.localizationName}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",children:[/*#__PURE__*/_jsx(Column,{gap:1,children:/*#__PURE__*/_jsx(CatalogSpinnerWidgetView,{})}),/*#__PURE__*/_jsx(CatalogTotalPriceWidget,{justifyContent:\"end\",alignItems:\"end\"})]}),/*#__PURE__*/_jsx(CatalogPurchaseWidgetView,{})]})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}