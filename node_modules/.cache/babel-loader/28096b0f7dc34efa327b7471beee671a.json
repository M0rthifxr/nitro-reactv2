{"ast":null,"code":"import{HabboClubLevelEnum,RoomControllerLevel}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useRef,useState}from'react';import{createPortal}from'react-dom';import{ChatMessageTypeEnum,GetClubMemberLevel,GetConfiguration,GetRoomSession,GetSessionDataManager,LocalizeText,RoomWidgetUpdateChatInputContentEvent}from'../../../../api';import{Text}from'../../../../common';import{useChatInputWidget,useSessionInfo,useUiEvent}from'../../../../hooks';import{ChatInputStyleSelectorView}from'./ChatInputStyleSelectorView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const ChatInputView=props=>{const[chatValue,setChatValue]=useState('');const{chatStyleId=0,updateChatStyleId=null}=useSessionInfo();const{selectedUsername='',floodBlocked=false,floodBlockedSeconds=0,setIsTyping=null,setIsIdle=null,sendChat=null}=useChatInputWidget();const inputRef=useRef();const chatModeIdWhisper=useMemo(()=>LocalizeText('widgets.chatinput.mode.whisper'),[]);const chatModeIdShout=useMemo(()=>LocalizeText('widgets.chatinput.mode.shout'),[]);const chatModeIdSpeak=useMemo(()=>LocalizeText('widgets.chatinput.mode.speak'),[]);const maxChatLength=useMemo(()=>GetConfiguration('chat.input.maxlength',100),[]);const anotherInputHasFocus=useCallback(()=>{const activeElement=document.activeElement;if(!activeElement)return false;if(inputRef&&inputRef.current===activeElement)return false;if(!(activeElement instanceof HTMLInputElement)&&!(activeElement instanceof HTMLTextAreaElement))return false;return true;},[inputRef]);const setInputFocus=useCallback(()=>{inputRef.current.focus();inputRef.current.setSelectionRange(inputRef.current.value.length*2,inputRef.current.value.length*2);},[inputRef]);const checkSpecialKeywordForInput=useCallback(()=>{setChatValue(prevValue=>{if(prevValue!==chatModeIdWhisper||!selectedUsername.length)return prevValue;return`${prevValue} ${selectedUsername}`;});},[selectedUsername,chatModeIdWhisper]);const sendChatValue=useCallback(function(value){let shiftKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!value||value==='')return;let chatType=shiftKey?ChatMessageTypeEnum.CHAT_SHOUT:ChatMessageTypeEnum.CHAT_DEFAULT;let text=value;const parts=text.split(' ');let recipientName='';let append='';switch(parts[0]){case chatModeIdWhisper:chatType=ChatMessageTypeEnum.CHAT_WHISPER;recipientName=parts[1];append=chatModeIdWhisper+' '+recipientName+' ';parts.shift();parts.shift();break;case chatModeIdShout:chatType=ChatMessageTypeEnum.CHAT_SHOUT;parts.shift();break;case chatModeIdSpeak:chatType=ChatMessageTypeEnum.CHAT_DEFAULT;parts.shift();break;}text=parts.join(' ');setIsTyping(false);setIsIdle(false);if(text.length<=maxChatLength){if(/%CC%/g.test(encodeURIComponent(text))){setChatValue('');}else{setChatValue('');sendChat(text,chatType,recipientName,chatStyleId);}}setChatValue(append);},[chatModeIdWhisper,chatModeIdShout,chatModeIdSpeak,maxChatLength,chatStyleId,setIsTyping,setIsIdle,sendChat]);const updateChatInput=useCallback(value=>{if(!value||!value.length){setIsTyping(false);}else{setIsTyping(true);setIsIdle(true);}setChatValue(value);},[setIsTyping,setIsIdle]);const onKeyDownEvent=useCallback(event=>{if(floodBlocked||!inputRef.current||anotherInputHasFocus())return;if(document.activeElement!==inputRef.current)setInputFocus();const value=event.target.value;switch(event.key){case' ':case'Space':checkSpecialKeywordForInput();return;case'NumpadEnter':case'Enter':sendChatValue(value,event.shiftKey);return;case'Backspace':if(value){const parts=value.split(' ');if(parts[0]===chatModeIdWhisper&&parts.length===3&&parts[2]===''){setChatValue('');}}return;}},[floodBlocked,inputRef,chatModeIdWhisper,anotherInputHasFocus,setInputFocus,checkSpecialKeywordForInput,sendChatValue]);useUiEvent(RoomWidgetUpdateChatInputContentEvent.CHAT_INPUT_CONTENT,event=>{switch(event.chatMode){case RoomWidgetUpdateChatInputContentEvent.WHISPER:{setChatValue(`${chatModeIdWhisper} ${event.userName} `);return;}case RoomWidgetUpdateChatInputContentEvent.SHOUT:return;}});const chatStyleIds=useMemo(()=>{let styleIds=[];const styles=GetConfiguration('chat.styles');for(const style of styles){if(!style)continue;if(style.minRank>0){if(GetSessionDataManager().hasSecurity(style.minRank))styleIds.push(style.styleId);continue;}if(style.isSystemStyle){if(GetSessionDataManager().hasSecurity(RoomControllerLevel.MODERATOR)){styleIds.push(style.styleId);continue;}}if(GetConfiguration('chat.styles.disabled').indexOf(style.styleId)>=0)continue;if(style.isHcOnly&&GetClubMemberLevel()>=HabboClubLevelEnum.CLUB){styleIds.push(style.styleId);continue;}if(style.isAmbassadorOnly&&GetSessionDataManager().isAmbassador){styleIds.push(style.styleId);continue;}if(!style.isHcOnly&&!style.isAmbassadorOnly)styleIds.push(style.styleId);}return styleIds;},[]);useEffect(()=>{document.body.addEventListener('keydown',onKeyDownEvent);return()=>{document.body.removeEventListener('keydown',onKeyDownEvent);};},[onKeyDownEvent]);useEffect(()=>{if(!inputRef.current)return;inputRef.current.parentElement.dataset.value=chatValue;},[chatValue]);if(GetRoomSession().isSpectator)return null;return/*#__PURE__*/createPortal(/*#__PURE__*/_jsxs(\"div\",{className:\"nitro-chat-input-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-sizer align-items-center\",children:[!floodBlocked&&/*#__PURE__*/_jsx(\"input\",{ref:inputRef,type:\"text\",className:\"chat-input\",placeholder:LocalizeText('widgets.chatinput.default'),value:chatValue,maxLength:maxChatLength,onChange:event=>updateChatInput(event.target.value),onMouseDown:event=>setInputFocus()}),floodBlocked&&/*#__PURE__*/_jsxs(Text,{variant:\"danger\",children:[LocalizeText('chat.input.alert.flood',['time'],[floodBlockedSeconds.toString()]),\" \"]})]}),/*#__PURE__*/_jsx(ChatInputStyleSelectorView,{chatStyleId:chatStyleId,chatStyleIds:chatStyleIds,selectChatStyleId:updateChatStyleId})]}),document.getElementById('toolbar-chat-input-container'));};","map":null,"metadata":{},"sourceType":"module"}