{"ast":null,"code":"import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{GroupInformationComposer,GroupInformationEvent,RoomControllerLevel,RoomObjectCategory,RoomObjectOperationType,RoomObjectVariable,RoomWidgetEnumItemExtradataParameter,RoomWidgetFurniInfoUsagePolicyEnum,SetObjectDataMessageComposer,StringDataType}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{CreateLinkEvent,GetGroupInformation,GetRoomEngine,LocalizeText,SendMessageComposer}from'../../../../../api';import{Button,Column,Flex,LayoutBadgeImageView,LayoutLimitedEditionCompactPlateView,LayoutRarityLevelView,Text,UserProfileIconView}from'../../../../../common';import{useMessageEvent,useRoom}from'../../../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const PICKUP_MODE_NONE=0;const PICKUP_MODE_EJECT=1;const PICKUP_MODE_FULL=2;export const InfoStandWidgetFurniView=props=>{const{avatarInfo=null,onClose=null}=props;const{roomSession=null}=useRoom();const[pickupMode,setPickupMode]=useState(0);const[canMove,setCanMove]=useState(false);const[canRotate,setCanRotate]=useState(false);const[canUse,setCanUse]=useState(false);const[furniKeys,setFurniKeys]=useState([]);const[furniValues,setFurniValues]=useState([]);const[customKeys,setCustomKeys]=useState([]);const[customValues,setCustomValues]=useState([]);const[isCrackable,setIsCrackable]=useState(false);const[crackableHits,setCrackableHits]=useState(0);const[crackableTarget,setCrackableTarget]=useState(0);const[godMode,setGodMode]=useState(false);const[canSeeFurniId,setCanSeeFurniId]=useState(false);const[groupName,setGroupName]=useState(null);useEffect(()=>{let pickupMode=PICKUP_MODE_NONE;let canMove=false;let canRotate=false;let canUse=false;let furniKeyss=[];let furniValuess=[];let customKeyss=[];let customValuess=[];let isCrackable=false;let crackableHits=0;let crackableTarget=0;let godMode=false;let canSeeFurniId=false;const isValidController=avatarInfo.roomControllerLevel>=RoomControllerLevel.GUEST;if(isValidController||avatarInfo.isOwner||avatarInfo.isRoomOwner||avatarInfo.isAnyRoomController){canMove=true;canRotate=!avatarInfo.isWallItem;if(avatarInfo.roomControllerLevel>=RoomControllerLevel.MODERATOR)godMode=true;}if(avatarInfo.isAnyRoomController){canSeeFurniId=true;}if(avatarInfo.usagePolicy===RoomWidgetFurniInfoUsagePolicyEnum.EVERYBODY||avatarInfo.usagePolicy===RoomWidgetFurniInfoUsagePolicyEnum.CONTROLLER&&isValidController||avatarInfo.extraParam===RoomWidgetEnumItemExtradataParameter.JUKEBOX&&isValidController||avatarInfo.extraParam===RoomWidgetEnumItemExtradataParameter.USABLE_PRODUCT&&isValidController)canUse=true;if(avatarInfo.extraParam){if(avatarInfo.extraParam===RoomWidgetEnumItemExtradataParameter.CRACKABLE_FURNI){const stuffData=avatarInfo.stuffData;canUse=true;isCrackable=true;crackableHits=stuffData.hits;crackableTarget=stuffData.target;}if(godMode){const extraParam=avatarInfo.extraParam.substr(RoomWidgetEnumItemExtradataParameter.BRANDING_OPTIONS.length);if(extraParam){const parts=extraParam.split('\\t');for(const part of parts){const value=part.split('=');if(value&&value.length===2){furniKeyss.push(value[0]);furniValuess.push(value[1]);}}}}}if(godMode){const roomObject=GetRoomEngine().getRoomObject(roomSession.roomId,avatarInfo.id,avatarInfo.isWallItem?RoomObjectCategory.WALL:RoomObjectCategory.FLOOR);if(roomObject){const customVariables=roomObject.model.getValue(RoomObjectVariable.FURNITURE_CUSTOM_VARIABLES);const furnitureData=roomObject.model.getValue(RoomObjectVariable.FURNITURE_DATA);if(customVariables&&customVariables.length){for(const customVariable of customVariables){customKeyss.push(customVariable);customValuess.push(furnitureData[customVariable]||'');}}}}if(avatarInfo.isOwner||avatarInfo.isAnyRoomController)pickupMode=PICKUP_MODE_FULL;else if(avatarInfo.isRoomOwner||avatarInfo.roomControllerLevel>=RoomControllerLevel.GUILD_ADMIN)pickupMode=PICKUP_MODE_EJECT;if(avatarInfo.isStickie)pickupMode=PICKUP_MODE_NONE;setPickupMode(pickupMode);setCanMove(canMove);setCanRotate(canRotate);setCanUse(canUse);setFurniKeys(furniKeyss);setFurniValues(furniValuess);setCustomKeys(customKeyss);setCustomValues(customValuess);setIsCrackable(isCrackable);setCrackableHits(crackableHits);setCrackableTarget(crackableTarget);setGodMode(godMode);setCanSeeFurniId(canSeeFurniId);setGroupName(null);if(avatarInfo.groupId)SendMessageComposer(new GroupInformationComposer(avatarInfo.groupId,false));},[roomSession,avatarInfo]);useMessageEvent(GroupInformationEvent,event=>{const parser=event.getParser();if(!avatarInfo||avatarInfo.groupId!==parser.id||parser.flag)return;if(groupName)setGroupName(null);setGroupName(parser.title);});const onFurniSettingChange=useCallback((index,value)=>{const clone=Array.from(furniValues);clone[index]=value;setFurniValues(clone);},[furniValues]);const onCustomVariableChange=useCallback((index,value)=>{const clone=Array.from(customValues);clone[index]=value;setCustomValues(clone);},[customValues]);const getFurniSettingsAsString=useCallback(()=>{if(furniKeys.length===0||furniValues.length===0)return'';let data='';let i=0;while(i<furniKeys.length){const key=furniKeys[i];const value=furniValues[i];data=data+(key+'='+value+'\\t');i++;}return data;},[furniKeys,furniValues]);const processButtonAction=useCallback(action=>{if(!action||action==='')return;let objectData=null;switch(action){case'buy_one':CreateLinkEvent(`catalog/open/offerId/${avatarInfo.purchaseOfferId}`);return;case'move':GetRoomEngine().processRoomObjectOperation(avatarInfo.id,avatarInfo.category,RoomObjectOperationType.OBJECT_MOVE);break;case'rotate':GetRoomEngine().processRoomObjectOperation(avatarInfo.id,avatarInfo.category,RoomObjectOperationType.OBJECT_ROTATE_POSITIVE);break;case'pickup':if(pickupMode===PICKUP_MODE_FULL){GetRoomEngine().processRoomObjectOperation(avatarInfo.id,avatarInfo.category,RoomObjectOperationType.OBJECT_PICKUP);}else{GetRoomEngine().processRoomObjectOperation(avatarInfo.id,avatarInfo.category,RoomObjectOperationType.OBJECT_EJECT);}break;case'use':GetRoomEngine().useRoomObject(avatarInfo.id,avatarInfo.category);break;case'save_branding_configuration':{const mapData=new Map();const dataParts=getFurniSettingsAsString().split('\\t');if(dataParts){for(const part of dataParts){const[key,value]=part.split('=',2);mapData.set(key,value);}}GetRoomEngine().modifyRoomObjectDataWithMap(avatarInfo.id,avatarInfo.category,RoomObjectOperationType.OBJECT_SAVE_STUFF_DATA,mapData);break;}case'save_custom_variables':{const map=new Map();for(let i=0;i<customKeys.length;i++){const key=customKeys[i];const value=customValues[i];if(key&&key.length&&value&&value.length)map.set(key,value);}SendMessageComposer(new SetObjectDataMessageComposer(avatarInfo.id,map));break;}}},[avatarInfo,pickupMode,customKeys,customValues,getFurniSettingsAsString]);const getGroupBadgeCode=useCallback(()=>{const stringDataType=avatarInfo.stuffData;if(!stringDataType||!(stringDataType instanceof StringDataType))return null;return stringDataType.getValue(2);},[avatarInfo]);if(!avatarInfo)return null;return/*#__PURE__*/_jsxs(Column,{gap:1,alignItems:\"end\",children:[/*#__PURE__*/_jsx(Column,{className:\"nitro-infostand rounded\",children:/*#__PURE__*/_jsxs(Column,{overflow:\"visible\",className:\"container-fluid content-area\",gap:1,children:[/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",gap:1,children:[/*#__PURE__*/_jsx(Text,{variant:\"white\",small:true,wrap:true,children:avatarInfo.name}),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"times\",className:\"cursor-pointer\",onClick:onClose})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsxs(Flex,{position:\"relative\",gap:1,children:[avatarInfo.stuffData.isUnique&&/*#__PURE__*/_jsx(\"div\",{className:\"position-absolute end-0\",children:/*#__PURE__*/_jsx(LayoutLimitedEditionCompactPlateView,{uniqueNumber:avatarInfo.stuffData.uniqueNumber,uniqueSeries:avatarInfo.stuffData.uniqueSeries})}),avatarInfo.stuffData.rarityLevel>-1&&/*#__PURE__*/_jsx(\"div\",{className:\"position-absolute end-0\",children:/*#__PURE__*/_jsx(LayoutRarityLevelView,{level:avatarInfo.stuffData.rarityLevel})}),avatarInfo.image&&avatarInfo.image.src.length&&/*#__PURE__*/_jsx(\"img\",{className:\"d-block mx-auto\",src:avatarInfo.image.src,alt:\"\"})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{fullWidth:true,wrap:true,textBreak:true,variant:\"white\",small:true,children:avatarInfo.description}),/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(UserProfileIconView,{userId:avatarInfo.ownerId}),/*#__PURE__*/_jsx(Text,{variant:\"white\",small:true,wrap:true,children:LocalizeText('furni.owner',['name'],[avatarInfo.ownerName])})]}),avatarInfo.purchaseOfferId>0&&/*#__PURE__*/_jsx(Flex,{children:/*#__PURE__*/_jsx(Text,{variant:\"white\",small:true,underline:true,pointer:true,onClick:event=>processButtonAction('buy_one'),children:LocalizeText('infostand.button.buy')})})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[isCrackable&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"}),/*#__PURE__*/_jsx(Text,{variant:\"white\",small:true,wrap:true,children:LocalizeText('infostand.crackable_furni.hits_remaining',['hits','target'],[crackableHits.toString(),crackableTarget.toString()])})]}),avatarInfo.groupId>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"}),/*#__PURE__*/_jsxs(Flex,{pointer:true,alignItems:\"center\",gap:2,onClick:()=>GetGroupInformation(avatarInfo.groupId),children:[/*#__PURE__*/_jsx(LayoutBadgeImageView,{badgeCode:getGroupBadgeCode(),isGroup:true}),/*#__PURE__*/_jsx(Text,{variant:\"white\",underline:true,children:groupName})]})]}),godMode&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"}),canSeeFurniId&&/*#__PURE__*/_jsxs(Text,{small:true,wrap:true,variant:\"white\",children:[\"ID: \",avatarInfo.id]}),furniKeys.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"}),/*#__PURE__*/_jsx(Column,{gap:1,children:furniKeys.map((key,index)=>{return/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(Text,{small:true,wrap:true,align:\"end\",variant:\"white\",className:\"col-4\",children:key}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm\",value:furniValues[index],onChange:event=>onFurniSettingChange(index,event.target.value)})]},index);})})]})]}),customKeys.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0 my-1\"}),/*#__PURE__*/_jsx(Column,{gap:1,children:customKeys.map((key,index)=>{return/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(Text,{small:true,wrap:true,align:\"end\",variant:\"white\",className:\"col-4\",children:key}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm\",value:customValues[index],onChange:event=>onCustomVariableChange(index,event.target.value)})]},index);})})]})]})]})}),/*#__PURE__*/_jsxs(Flex,{gap:1,justifyContent:\"end\",children:[canMove&&/*#__PURE__*/_jsx(Button,{variant:\"dark\",onClick:event=>processButtonAction('move'),children:LocalizeText('infostand.button.move')}),canRotate&&/*#__PURE__*/_jsx(Button,{variant:\"dark\",onClick:event=>processButtonAction('rotate'),children:LocalizeText('infostand.button.rotate')}),pickupMode!==PICKUP_MODE_NONE&&/*#__PURE__*/_jsx(Button,{variant:\"dark\",onClick:event=>processButtonAction('pickup'),children:LocalizeText(pickupMode===PICKUP_MODE_EJECT?'infostand.button.eject':'infostand.button.pickup')}),canUse&&/*#__PURE__*/_jsx(Button,{variant:\"dark\",onClick:event=>processButtonAction('use'),children:LocalizeText('infostand.button.use')}),furniKeys.length>0&&furniValues.length>0&&furniKeys.length===furniValues.length&&/*#__PURE__*/_jsx(Button,{variant:\"dark\",onClick:()=>processButtonAction('save_branding_configuration'),children:LocalizeText('save')}),customKeys.length>0&&customValues.length>0&&customKeys.length===customValues.length&&/*#__PURE__*/_jsx(Button,{variant:\"dark\",onClick:()=>processButtonAction('save_custom_variables'),children:LocalizeText('save')})]})]});};","map":null,"metadata":{},"sourceType":"module"}