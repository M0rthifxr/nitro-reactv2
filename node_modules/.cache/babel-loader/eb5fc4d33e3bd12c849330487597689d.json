{"ast":null,"code":"import{PetRespectComposer,PetType,RoomObjectCategory,RoomObjectType,RoomObjectVariable,RoomUnitGiveHandItemPetComposer}from'@nitrots/nitro-renderer';import{useEffect,useMemo,useState}from'react';import{CreateLinkEvent,GetConfiguration,GetOwnRoomObject,LocalizeText,SendMessageComposer}from'../../../../../api';import{useRoom,useSessionInfo}from'../../../../../hooks';import{ContextMenuHeaderView}from'../../context-menu/ContextMenuHeaderView';import{ContextMenuListItemView}from'../../context-menu/ContextMenuListItemView';import{ContextMenuView}from'../../context-menu/ContextMenuView';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const MODE_NORMAL=0;const MODE_SADDLED_UP=1;const MODE_RIDING=2;const MODE_MONSTER_PLANT=3;export const AvatarInfoWidgetOwnPetView=props=>{const{avatarInfo=null,onClose=null}=props;const[mode,setMode]=useState(MODE_NORMAL);const{roomSession=null}=useRoom();const{petRespectRemaining=0,respectPet=null}=useSessionInfo();const canGiveHandItem=useMemo(()=>{let flag=false;const roomObject=GetOwnRoomObject();if(roomObject){const carryId=roomObject.model.getValue(RoomObjectVariable.FIGURE_CARRY_OBJECT);if(carryId>0&&carryId<999999)flag=true;}return flag;},[]);const processAction=name=>{let hideMenu=true;if(name){switch(name){case'respect':respectPet(avatarInfo.id);if(petRespectRemaining-1>=1)hideMenu=false;break;case'treat':SendMessageComposer(new PetRespectComposer(avatarInfo.id));break;case'pass_handitem':SendMessageComposer(new RoomUnitGiveHandItemPetComposer(avatarInfo.id));break;case'train'://this.widget._Str_23877();\nbreak;case'pick_up':roomSession.pickupPet(avatarInfo.id);break;case'mount':roomSession.mountPet(avatarInfo.id);break;case'toggle_riding_permission':roomSession.togglePetRiding(avatarInfo.id);break;case'toggle_breeding_permission':roomSession.togglePetBreeding(avatarInfo.id);break;case'dismount':roomSession.dismountPet(avatarInfo.id);break;case'saddle_off':roomSession.removePetSaddle(avatarInfo.id);break;case'breed':if(mode===MODE_NORMAL){// _local_7 = RoomWidgetPetCommandMessage._Str_16282;\n// _local_8 = (\"pet.command.\" + _local_7);\n// _local_9 = _Str_2268.catalog.localization.getLocalization(_local_8);\n// _local_4 = new RoomWidgetPetCommandMessage(RoomWidgetPetCommandMessage.RWPCM_PET_COMMAND, this._Str_594.id, ((this._Str_594.name + \" \") + _local_9));\n}else if(mode===MODE_MONSTER_PLANT){// messageType = RoomWidgetUserActionMessage.REQUEST_BREED_PET;\n}break;case'harvest':roomSession.harvestPet(avatarInfo.id);break;case'revive'://\nbreak;case'compost':roomSession.compostPlant(avatarInfo.id);break;case'buy_saddle':CreateLinkEvent('catalog/open/'+GetConfiguration('catalog.links')['pets.buy_saddle']);break;}}if(hideMenu)onClose();};useEffect(()=>{setMode(prevValue=>{if(avatarInfo.petType===PetType.MONSTERPLANT)return MODE_MONSTER_PLANT;else if(avatarInfo.saddle&&!avatarInfo.rider)return MODE_SADDLED_UP;else if(avatarInfo.rider)return MODE_RIDING;return MODE_NORMAL;});},[avatarInfo]);return/*#__PURE__*/_jsxs(ContextMenuView,{objectId:avatarInfo.roomIndex,category:RoomObjectCategory.UNIT,userType:RoomObjectType.PET,onClose:onClose,collapsable:true,children:[/*#__PURE__*/_jsx(ContextMenuHeaderView,{children:avatarInfo.name}),mode===MODE_NORMAL&&/*#__PURE__*/_jsxs(_Fragment,{children:[petRespectRemaining>0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('respect'),children:LocalizeText('infostand.button.petrespect',['count'],[petRespectRemaining.toString()])}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('train'),children:LocalizeText('infostand.button.train')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('pick_up'),children:LocalizeText('infostand.button.pickup')}),avatarInfo.petType===PetType.HORSE&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('buy_saddle'),children:LocalizeText('infostand.button.buy_saddle')}),[PetType.BEAR,PetType.TERRIER,PetType.CAT,PetType.DOG,PetType.PIG].indexOf(avatarInfo.petType)>-1&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('breed'),children:LocalizeText('infostand.button.breed')})]}),mode===MODE_SADDLED_UP&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('mount'),children:LocalizeText('infostand.button.mount')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('toggle_riding_permission'),gap:1,children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:!!avatarInfo.publiclyRideable,readOnly:true}),LocalizeText('infostand.button.toggle_riding_permission')]}),petRespectRemaining>0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('respect'),children:LocalizeText('infostand.button.petrespect',['count'],[petRespectRemaining.toString()])}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('train'),children:LocalizeText('infostand.button.train')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('pick_up'),children:LocalizeText('infostand.button.pickup')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('saddle_off'),children:LocalizeText('infostand.button.saddleoff')})]}),mode===MODE_RIDING&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('dismount'),children:LocalizeText('infostand.button.dismount')}),petRespectRemaining>0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('respect'),children:LocalizeText('infostand.button.petrespect',['count'],[petRespectRemaining.toString()])})]}),mode===MODE_MONSTER_PLANT&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('pick_up'),children:LocalizeText('infostand.button.pickup')}),avatarInfo.dead&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('revive'),children:LocalizeText('infostand.button.revive')}),roomSession.isRoomOwner&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('compost'),children:LocalizeText('infostand.button.compost')}),!avatarInfo.dead&&avatarInfo.energy/avatarInfo.maximumEnergy<0.98&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('treat'),children:LocalizeText('infostand.button.pettreat')}),!avatarInfo.dead&&avatarInfo.level===avatarInfo.maximumLevel&&avatarInfo.breedable&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('toggle_breeding_permission'),gap:1,children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:avatarInfo.publiclyBreedable,readOnly:true}),LocalizeText('infostand.button.toggle_breeding_permission')]}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('breed'),children:LocalizeText('infostand.button.breed')})]})]}),canGiveHandItem&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('pass_hand_item'),children:LocalizeText('infostand.button.pass_hand_item')})]});};","map":null,"metadata":{},"sourceType":"module"}