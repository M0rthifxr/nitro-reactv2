{"ast":null,"code":"import{RoomSessionEvent}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{AddEventLinkTracker,RemoveLinkEventTracker}from'../../api';import{useCamera,useRoomSessionManagerEvent}from'../../hooks';import{CameraWidgetCaptureView}from'./views/CameraWidgetCaptureView';import{CameraWidgetCheckoutView}from'./views/CameraWidgetCheckoutView';import{CameraWidgetEditorView}from'./views/editor/CameraWidgetEditorView';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const MODE_NONE=0;const MODE_CAPTURE=1;const MODE_EDITOR=2;const MODE_CHECKOUT=3;export const CameraWidgetView=props=>{const[mode,setMode]=useState(MODE_NONE);const[base64Url,setSavedPictureUrl]=useState(null);const{availableEffects=[],selectedPictureIndex=-1,cameraRoll=[],setCameraRoll=null,myLevel=0,price={credits:0,duckets:0,publishDucketPrice:0}}=useCamera();const processAction=type=>{switch(type){case'close':setMode(MODE_NONE);return;case'edit':setMode(MODE_EDITOR);return;case'delete':setCameraRoll(prevValue=>{const clone=[...prevValue];clone.splice(selectedPictureIndex,1);return clone;});return;case'editor_cancel':setMode(MODE_CAPTURE);return;}};const checkoutPictureUrl=useCallback(pictureUrl=>{setSavedPictureUrl(pictureUrl);setMode(MODE_CHECKOUT);},[]);useRoomSessionManagerEvent(RoomSessionEvent.ENDED,event=>setMode(MODE_NONE));useEffect(()=>{const linkTracker={linkReceived:url=>{const parts=url.split('/');if(parts.length<2)return;switch(parts[1]){case'show':setMode(MODE_CAPTURE);return;case'hide':setMode(MODE_NONE);return;case'toggle':setMode(prevValue=>{if(!prevValue)return MODE_CAPTURE;else return MODE_NONE;});return;}},eventUrlPrefix:'camera/'};AddEventLinkTracker(linkTracker);return()=>RemoveLinkEventTracker(linkTracker);},[]);if(mode===MODE_NONE)return null;return/*#__PURE__*/_jsxs(_Fragment,{children:[mode===MODE_CAPTURE&&/*#__PURE__*/_jsx(CameraWidgetCaptureView,{onClose:()=>processAction('close'),onEdit:()=>processAction('edit'),onDelete:()=>processAction('delete')}),mode===MODE_EDITOR&&/*#__PURE__*/_jsx(CameraWidgetEditorView,{picture:cameraRoll[selectedPictureIndex],myLevel:myLevel,onClose:()=>processAction('close'),onCancel:()=>processAction('editor_cancel'),onCheckout:checkoutPictureUrl,availableEffects:availableEffects}),mode===MODE_CHECKOUT&&/*#__PURE__*/_jsx(CameraWidgetCheckoutView,{base64Url:base64Url,onCloseClick:()=>processAction('close'),onCancelClick:()=>processAction('editor_cancel'),price:price})]});};","map":null,"metadata":{},"sourceType":"module"}