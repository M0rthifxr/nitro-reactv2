{"ast":null,"code":"import{PetRespectComposer,PetType,RoomControllerLevel,RoomObjectCategory,RoomObjectType,RoomObjectVariable,RoomUnitGiveHandItemPetComposer}from'@nitrots/nitro-renderer';import{useEffect,useMemo,useState}from'react';import{GetOwnRoomObject,GetSessionDataManager,LocalizeText,SendMessageComposer}from'../../../../../api';import{useRoom,useSessionInfo}from'../../../../../hooks';import{ContextMenuHeaderView}from'../../context-menu/ContextMenuHeaderView';import{ContextMenuListItemView}from'../../context-menu/ContextMenuListItemView';import{ContextMenuView}from'../../context-menu/ContextMenuView';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const MODE_NORMAL=0;const MODE_SADDLED_UP=1;const MODE_RIDING=2;const MODE_MONSTER_PLANT=3;export const AvatarInfoWidgetPetView=props=>{const{avatarInfo=null,onClose=null}=props;const[mode,setMode]=useState(MODE_NORMAL);const{roomSession=null}=useRoom();const{petRespectRemaining=0,respectPet=null}=useSessionInfo();const canPickUp=useMemo(()=>{return roomSession.isRoomOwner||roomSession.controllerLevel>=RoomControllerLevel.GUEST||GetSessionDataManager().isModerator;},[roomSession]);const canGiveHandItem=useMemo(()=>{let flag=false;const roomObject=GetOwnRoomObject();if(roomObject){const carryId=roomObject.model.getValue(RoomObjectVariable.FIGURE_CARRY_OBJECT);if(carryId>0&&carryId<999999)flag=true;}return flag;},[]);const processAction=name=>{let hideMenu=true;if(name){switch(name){case'respect':respectPet(avatarInfo.id);if(petRespectRemaining-1>=1)hideMenu=false;break;case'treat':SendMessageComposer(new PetRespectComposer(avatarInfo.id));break;case'pass_handitem':SendMessageComposer(new RoomUnitGiveHandItemPetComposer(avatarInfo.id));break;case'pick_up':roomSession.pickupPet(avatarInfo.id);break;case'mount':roomSession.mountPet(avatarInfo.id);break;case'dismount':roomSession.dismountPet(avatarInfo.id);break;}}if(hideMenu)onClose();};useEffect(()=>{setMode(prevValue=>{if(avatarInfo.petType===PetType.MONSTERPLANT)return MODE_MONSTER_PLANT;else if(avatarInfo.saddle&&!avatarInfo.rider)return MODE_SADDLED_UP;else if(avatarInfo.rider)return MODE_RIDING;return MODE_NORMAL;});},[avatarInfo]);return/*#__PURE__*/_jsxs(ContextMenuView,{objectId:avatarInfo.roomIndex,category:RoomObjectCategory.UNIT,userType:RoomObjectType.PET,onClose:onClose,collapsable:true,children:[/*#__PURE__*/_jsx(ContextMenuHeaderView,{children:avatarInfo.name}),mode===MODE_NORMAL&&petRespectRemaining>0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('respect'),children:LocalizeText('infostand.button.petrespect',['count'],[petRespectRemaining.toString()])}),mode===MODE_SADDLED_UP&&/*#__PURE__*/_jsxs(_Fragment,{children:[!!avatarInfo.publiclyRideable&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('mount'),children:LocalizeText('infostand.button.mount')}),petRespectRemaining>0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('respect'),children:LocalizeText('infostand.button.petrespect',['count'],[petRespectRemaining.toString()])})]}),mode===MODE_RIDING&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('dismount'),children:LocalizeText('infostand.button.dismount')}),petRespectRemaining>0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('respect'),children:LocalizeText('infostand.button.petrespect',['count'],[petRespectRemaining.toString()])})]}),mode===MODE_MONSTER_PLANT&&!avatarInfo.dead&&avatarInfo.energy/avatarInfo.maximumEnergy<0.98&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('treat'),children:LocalizeText('infostand.button.pettreat')}),canPickUp&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('pick_up'),children:LocalizeText('infostand.button.pickup')}),canGiveHandItem&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('pass_hand_item'),children:LocalizeText('infostand.button.pass_hand_item')})]});};","map":null,"metadata":{},"sourceType":"module"}