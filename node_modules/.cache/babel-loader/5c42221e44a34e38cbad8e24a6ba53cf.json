{"ast":null,"code":"import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{RoomControllerLevel,RoomObjectCategory,RoomObjectVariable,RoomUnitGiveHandItemComposer,SetRelationshipStatusComposer,TradingOpenComposer}from'@nitrots/nitro-renderer';import{useEffect,useMemo,useState}from'react';import{CreateLinkEvent,DispatchUiEvent,GetOwnRoomObject,GetSessionDataManager,GetUserProfile,LocalizeText,MessengerFriend,ReportType,RoomWidgetUpdateChatInputContentEvent,SendMessageComposer}from'../../../../../api';import{Base,Flex}from'../../../../../common';import{useFriends,useHelp,useRoom,useSessionInfo}from'../../../../../hooks';import{ContextMenuHeaderView}from'../../context-menu/ContextMenuHeaderView';import{ContextMenuListItemView}from'../../context-menu/ContextMenuListItemView';import{ContextMenuView}from'../../context-menu/ContextMenuView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const MODE_NORMAL=0;const MODE_MODERATE=1;const MODE_MODERATE_BAN=2;const MODE_MODERATE_MUTE=3;const MODE_AMBASSADOR=4;const MODE_AMBASSADOR_MUTE=5;const MODE_RELATIONSHIP=6;export const AvatarInfoWidgetAvatarView=props=>{const{avatarInfo=null,onClose=null}=props;const[mode,setMode]=useState(MODE_NORMAL);const{canRequestFriend=null}=useFriends();const{report=null}=useHelp();const{roomSession=null}=useRoom();const{userRespectRemaining=0,respectUser=null}=useSessionInfo();const isShowGiveRights=useMemo(()=>{return avatarInfo.amIOwner&&avatarInfo.targetRoomControllerLevel<RoomControllerLevel.GUEST&&!avatarInfo.isGuildRoom;},[avatarInfo]);const isShowRemoveRights=useMemo(()=>{return avatarInfo.amIOwner&&avatarInfo.targetRoomControllerLevel===RoomControllerLevel.GUEST&&!avatarInfo.isGuildRoom;},[avatarInfo]);const moderateMenuHasContent=useMemo(()=>{return avatarInfo.canBeKicked||avatarInfo.canBeBanned||avatarInfo.canBeMuted||isShowGiveRights||isShowRemoveRights;},[isShowGiveRights,isShowRemoveRights,avatarInfo]);const canGiveHandItem=useMemo(()=>{let flag=false;const roomObject=GetOwnRoomObject();if(roomObject){const carryId=roomObject.model.getValue(RoomObjectVariable.FIGURE_CARRY_OBJECT);if(carryId>0&&carryId<999999)flag=true;}return flag;},[]);const processAction=name=>{let hideMenu=true;if(name){switch(name){case'moderate':hideMenu=false;setMode(MODE_MODERATE);break;case'ban':hideMenu=false;setMode(MODE_MODERATE_BAN);break;case'mute':hideMenu=false;setMode(MODE_MODERATE_MUTE);break;case'ambassador':hideMenu=false;setMode(MODE_AMBASSADOR);break;case'ambassador_mute':hideMenu=false;setMode(MODE_AMBASSADOR_MUTE);break;case'back_moderate':hideMenu=false;setMode(MODE_MODERATE);break;case'back_ambassador':hideMenu=false;setMode(MODE_AMBASSADOR);break;case'back':hideMenu=false;setMode(MODE_NORMAL);break;case'whisper':DispatchUiEvent(new RoomWidgetUpdateChatInputContentEvent(RoomWidgetUpdateChatInputContentEvent.WHISPER,avatarInfo.name));break;case'friend':CreateLinkEvent(`friends/request/${avatarInfo.webID}/${avatarInfo.name}`);break;case'relationship':hideMenu=false;setMode(MODE_RELATIONSHIP);break;case'respect':{respectUser(avatarInfo.webID);if(userRespectRemaining-1>=1)hideMenu=false;break;}case'ignore':GetSessionDataManager().ignoreUser(avatarInfo.name);break;case'unignore':GetSessionDataManager().unignoreUser(avatarInfo.name);break;case'kick':roomSession.sendKickMessage(avatarInfo.webID);break;case'ban_hour':roomSession.sendBanMessage(avatarInfo.webID,'RWUAM_BAN_USER_HOUR');break;case'ban_day':roomSession.sendBanMessage(avatarInfo.webID,'RWUAM_BAN_USER_DAY');break;case'perm_ban':roomSession.sendBanMessage(avatarInfo.webID,'RWUAM_BAN_USER_PERM');break;case'mute_2min':roomSession.sendMuteMessage(avatarInfo.webID,2);break;case'mute_5min':roomSession.sendMuteMessage(avatarInfo.webID,5);break;case'mute_10min':roomSession.sendMuteMessage(avatarInfo.webID,10);break;case'give_rights':roomSession.sendGiveRightsMessage(avatarInfo.webID);break;case'remove_rights':roomSession.sendTakeRightsMessage(avatarInfo.webID);break;case'trade':SendMessageComposer(new TradingOpenComposer(avatarInfo.roomIndex));break;case'report':report(ReportType.BULLY,{reportedUserId:avatarInfo.webID});break;case'pass_hand_item':SendMessageComposer(new RoomUnitGiveHandItemComposer(avatarInfo.webID));break;case'ambassador_alert':roomSession.sendAmbassadorAlertMessage(avatarInfo.webID);break;case'ambassador_kick':roomSession.sendKickMessage(avatarInfo.webID);break;case'ambassador_mute_2min':roomSession.sendMuteMessage(avatarInfo.webID,2);break;case'ambassador_mute_10min':roomSession.sendMuteMessage(avatarInfo.webID,10);break;case'ambassador_mute_60min':roomSession.sendMuteMessage(avatarInfo.webID,60);break;case'ambassador_mute_18hour':roomSession.sendMuteMessage(avatarInfo.webID,1080);break;case'rship_heart':SendMessageComposer(new SetRelationshipStatusComposer(avatarInfo.webID,MessengerFriend.RELATIONSHIP_HEART));break;case'rship_smile':SendMessageComposer(new SetRelationshipStatusComposer(avatarInfo.webID,MessengerFriend.RELATIONSHIP_SMILE));break;case'rship_bobba':SendMessageComposer(new SetRelationshipStatusComposer(avatarInfo.webID,MessengerFriend.RELATIONSHIP_BOBBA));break;case'rship_none':SendMessageComposer(new SetRelationshipStatusComposer(avatarInfo.webID,MessengerFriend.RELATIONSHIP_NONE));break;}}if(hideMenu)onClose();};useEffect(()=>{setMode(MODE_NORMAL);},[avatarInfo]);return/*#__PURE__*/_jsxs(ContextMenuView,{objectId:avatarInfo.roomIndex,category:RoomObjectCategory.UNIT,userType:avatarInfo.userType,onClose:onClose,collapsable:true,children:[/*#__PURE__*/_jsx(ContextMenuHeaderView,{className:\"cursor-pointer\",onClick:event=>GetUserProfile(avatarInfo.webID),children:avatarInfo.name}),mode===MODE_NORMAL&&/*#__PURE__*/_jsxs(_Fragment,{children:[canRequestFriend(avatarInfo.webID)&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('friend'),children:LocalizeText('infostand.button.friend')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('trade'),children:LocalizeText('infostand.button.trade')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('whisper'),children:LocalizeText('infostand.button.whisper')}),userRespectRemaining>0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('respect'),children:LocalizeText('infostand.button.respect',['count'],[userRespectRemaining.toString()])}),!canRequestFriend(avatarInfo.webID)&&/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('relationship'),children:[LocalizeText('infostand.link.relationship'),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"})]}),!avatarInfo.isIgnored&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ignore'),children:LocalizeText('infostand.button.ignore')}),avatarInfo.isIgnored&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('unignore'),children:LocalizeText('infostand.button.unignore')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('report'),children:LocalizeText('infostand.button.report')}),moderateMenuHasContent&&/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('moderate'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"}),LocalizeText('infostand.link.moderate')]}),avatarInfo.isAmbassador&&/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('ambassador'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"}),LocalizeText('infostand.link.ambassador')]}),canGiveHandItem&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('pass_hand_item'),children:LocalizeText('avatar.widget.pass_hand_item')})]}),mode===MODE_MODERATE&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('kick'),children:LocalizeText('infostand.button.kick')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('mute'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"}),LocalizeText('infostand.button.mute')]}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('ban'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"}),LocalizeText('infostand.button.ban')]}),isShowGiveRights&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('give_rights'),children:LocalizeText('infostand.button.giverights')}),isShowRemoveRights&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('remove_rights'),children:LocalizeText('infostand.button.removerights')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_MODERATE_BAN&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ban_hour'),children:LocalizeText('infostand.button.ban_hour')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ban_day'),children:LocalizeText('infostand.button.ban_day')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('perm_ban'),children:LocalizeText('infostand.button.perm_ban')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back_moderate'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_MODERATE_MUTE&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('mute_2min'),children:LocalizeText('infostand.button.mute_2min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('mute_5min'),children:LocalizeText('infostand.button.mute_5min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('mute_10min'),children:LocalizeText('infostand.button.mute_10min')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back_moderate'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_AMBASSADOR&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_alert'),children:LocalizeText('infostand.button.alert')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_kick'),children:LocalizeText('infostand.button.kick')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute'),children:[LocalizeText('infostand.button.mute'),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"})]}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_AMBASSADOR_MUTE&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute_2min'),children:LocalizeText('infostand.button.mute_2min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute_10min'),children:LocalizeText('infostand.button.mute_10min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute_60min'),children:LocalizeText('infostand.button.mute_60min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute_18hr'),children:LocalizeText('infostand.button.mute_18hour')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back_ambassador'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_RELATIONSHIP&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Flex,{className:\"menu-list-split-3\",children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('rship_heart'),children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"nitro-friends-spritesheet icon-heart\"})}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('rship_smile'),children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"nitro-friends-spritesheet icon-smile\"})}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('rship_bobba'),children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"nitro-friends-spritesheet icon-bobba\"})})]}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('rship_none'),children:LocalizeText('avatar.widget.clear_relationship')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]})]});};","map":null,"metadata":{},"sourceType":"module"}