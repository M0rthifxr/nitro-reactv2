{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ChiiO\\\\Desktop\\\\nitro-reactdev\\\\src\\\\components\\\\camera\\\\CameraWidgetView.tsx\",\n    _s = $RefreshSig$();\n\nimport { RoomSessionEvent } from '@nitrots/nitro-renderer';\nimport { useCallback, useEffect, useState } from 'react';\nimport { AddEventLinkTracker, RemoveLinkEventTracker } from '../../api';\nimport { useCamera, useRoomSessionManagerEvent } from '../../hooks';\nimport { CameraWidgetCaptureView } from './views/CameraWidgetCaptureView';\nimport { CameraWidgetCheckoutView } from './views/CameraWidgetCheckoutView';\nimport { CameraWidgetEditorView } from './views/editor/CameraWidgetEditorView';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst MODE_NONE = 0;\nconst MODE_CAPTURE = 1;\nconst MODE_EDITOR = 2;\nconst MODE_CHECKOUT = 3;\nexport const CameraWidgetView = props => {\n  _s();\n\n  const [mode, setMode] = useState(MODE_NONE);\n  const [base64Url, setSavedPictureUrl] = useState(null);\n  const {\n    availableEffects = [],\n    selectedPictureIndex = -1,\n    cameraRoll = [],\n    setCameraRoll = null,\n    myLevel = 0,\n    price = {\n      credits: 0,\n      duckets: 0,\n      publishDucketPrice: 0\n    }\n  } = useCamera();\n\n  const processAction = type => {\n    switch (type) {\n      case 'close':\n        setMode(MODE_NONE);\n        return;\n\n      case 'edit':\n        setMode(MODE_EDITOR);\n        return;\n\n      case 'delete':\n        setCameraRoll(prevValue => {\n          const clone = [...prevValue];\n          clone.splice(selectedPictureIndex, 1);\n          return clone;\n        });\n        return;\n\n      case 'editor_cancel':\n        setMode(MODE_CAPTURE);\n        return;\n    }\n  };\n\n  const checkoutPictureUrl = useCallback(pictureUrl => {\n    setSavedPictureUrl(pictureUrl);\n    setMode(MODE_CHECKOUT);\n  }, []);\n  useRoomSessionManagerEvent(RoomSessionEvent.ENDED, event => setMode(MODE_NONE));\n  useEffect(() => {\n    const linkTracker = {\n      linkReceived: url => {\n        const parts = url.split('/');\n        if (parts.length < 2) return;\n\n        switch (parts[1]) {\n          case 'show':\n            setMode(MODE_CAPTURE);\n            return;\n\n          case 'hide':\n            setMode(MODE_NONE);\n            return;\n\n          case 'toggle':\n            setMode(prevValue => {\n              if (!prevValue) return MODE_CAPTURE;else return MODE_NONE;\n            });\n            return;\n        }\n      },\n      eventUrlPrefix: 'camera/'\n    };\n    AddEventLinkTracker(linkTracker);\n    return () => RemoveLinkEventTracker(linkTracker);\n  }, []);\n  if (mode === MODE_NONE) return null;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [mode === MODE_CAPTURE && /*#__PURE__*/_jsxDEV(CameraWidgetCaptureView, {\n      onClose: () => processAction('close'),\n      onEdit: () => processAction('edit'),\n      onDelete: () => processAction('delete')\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 42\n    }, this), mode === MODE_EDITOR && /*#__PURE__*/_jsxDEV(CameraWidgetEditorView, {\n      picture: cameraRoll[selectedPictureIndex],\n      myLevel: myLevel,\n      onClose: () => processAction('close'),\n      onCancel: () => processAction('editor_cancel'),\n      onCheckout: checkoutPictureUrl,\n      availableEffects: availableEffects\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 41\n    }, this), mode === MODE_CHECKOUT && /*#__PURE__*/_jsxDEV(CameraWidgetCheckoutView, {\n      base64Url: base64Url,\n      onCloseClick: () => processAction('close'),\n      onCancelClick: () => processAction('editor_cancel'),\n      price: price\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 43\n    }, this)]\n  }, void 0, true);\n};\n\n_s(CameraWidgetView, \"g8kWIIVZVA6LdOt+D9uwqFxE8vo=\", false, function () {\n  return [useCamera, useRoomSessionManagerEvent];\n});\n\n_c = CameraWidgetView;\n\nvar _c;\n\n$RefreshReg$(_c, \"CameraWidgetView\");","map":{"version":3,"names":["RoomSessionEvent","useCallback","useEffect","useState","AddEventLinkTracker","RemoveLinkEventTracker","useCamera","useRoomSessionManagerEvent","CameraWidgetCaptureView","CameraWidgetCheckoutView","CameraWidgetEditorView","MODE_NONE","MODE_CAPTURE","MODE_EDITOR","MODE_CHECKOUT","CameraWidgetView","props","mode","setMode","base64Url","setSavedPictureUrl","availableEffects","selectedPictureIndex","cameraRoll","setCameraRoll","myLevel","price","credits","duckets","publishDucketPrice","processAction","type","prevValue","clone","splice","checkoutPictureUrl","pictureUrl","ENDED","event","linkTracker","linkReceived","url","parts","split","length","eventUrlPrefix"],"sources":["C:/Users/ChiiO/Desktop/nitro-reactdev/src/components/camera/CameraWidgetView.tsx"],"sourcesContent":["import { ILinkEventTracker, RoomSessionEvent } from '@nitrots/nitro-renderer';\r\nimport { FC, useCallback, useEffect, useState } from 'react';\r\nimport { AddEventLinkTracker, RemoveLinkEventTracker } from '../../api';\r\nimport { useCamera, useRoomSessionManagerEvent } from '../../hooks';\r\nimport { CameraWidgetCaptureView } from './views/CameraWidgetCaptureView';\r\nimport { CameraWidgetCheckoutView } from './views/CameraWidgetCheckoutView';\r\nimport { CameraWidgetEditorView } from './views/editor/CameraWidgetEditorView';\r\n\r\nconst MODE_NONE: number = 0;\r\nconst MODE_CAPTURE: number = 1;\r\nconst MODE_EDITOR: number = 2;\r\nconst MODE_CHECKOUT: number = 3;\r\n\r\nexport const CameraWidgetView: FC<{}> = props =>\r\n{\r\n    const [ mode, setMode ] = useState<number>(MODE_NONE);\r\n    const [ base64Url, setSavedPictureUrl ] = useState<string>(null);\r\n    const { availableEffects = [], selectedPictureIndex = -1, cameraRoll = [], setCameraRoll = null, myLevel = 0, price = { credits: 0, duckets: 0, publishDucketPrice: 0 }} = useCamera();\r\n\r\n    const processAction = (type: string) =>\r\n    {\r\n        switch(type)\r\n        {\r\n            case 'close':\r\n                setMode(MODE_NONE);\r\n                return;\r\n            case 'edit':\r\n                setMode(MODE_EDITOR);\r\n                return;\r\n            case 'delete':\r\n                setCameraRoll(prevValue =>\r\n                {\r\n                    const clone = [ ...prevValue ];\r\n\r\n                    clone.splice(selectedPictureIndex, 1);\r\n\r\n                    return clone;\r\n                });\r\n                return;\r\n            case 'editor_cancel':\r\n                setMode(MODE_CAPTURE);\r\n                return;\r\n        }\r\n    }\r\n\r\n    const checkoutPictureUrl = useCallback((pictureUrl: string) =>\r\n    {\r\n        setSavedPictureUrl(pictureUrl);\r\n        setMode(MODE_CHECKOUT);\r\n    }, []);\r\n\r\n    useRoomSessionManagerEvent<RoomSessionEvent>(RoomSessionEvent.ENDED, event => setMode(MODE_NONE));\r\n\r\n    useEffect(() =>\r\n    {\r\n        const linkTracker: ILinkEventTracker = {\r\n            linkReceived: (url: string) =>\r\n            {\r\n                const parts = url.split('/');\r\n        \r\n                if(parts.length < 2) return;\r\n        \r\n                switch(parts[1])\r\n                {\r\n                    case 'show':\r\n                        setMode(MODE_CAPTURE);\r\n                        return;\r\n                    case 'hide':\r\n                        setMode(MODE_NONE);\r\n                        return;\r\n                    case 'toggle':\r\n                        setMode(prevValue =>\r\n                        {\r\n                            if(!prevValue) return MODE_CAPTURE;\r\n                            else return MODE_NONE;\r\n                        });\r\n                        return;\r\n                }\r\n            },\r\n            eventUrlPrefix: 'camera/'\r\n        };\r\n\r\n        AddEventLinkTracker(linkTracker);\r\n\r\n        return () => RemoveLinkEventTracker(linkTracker);\r\n    }, []);\r\n\r\n    if(mode === MODE_NONE) return null;\r\n\r\n    return (\r\n        <>\r\n            { (mode === MODE_CAPTURE) && <CameraWidgetCaptureView onClose={ () => processAction('close') } onEdit={ () => processAction('edit') } onDelete={ () => processAction('delete') } /> }\r\n            { (mode === MODE_EDITOR) && <CameraWidgetEditorView picture={ cameraRoll[selectedPictureIndex] } myLevel={ myLevel } onClose={ () => processAction('close') } onCancel={ () => processAction('editor_cancel') } onCheckout={ checkoutPictureUrl } availableEffects={ availableEffects } /> }\r\n            { (mode === MODE_CHECKOUT) && <CameraWidgetCheckoutView base64Url={ base64Url } onCloseClick={ () => processAction('close') } onCancelClick={ () => processAction('editor_cancel') } price={ price }></CameraWidgetCheckoutView> }\r\n        </>\r\n    );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}