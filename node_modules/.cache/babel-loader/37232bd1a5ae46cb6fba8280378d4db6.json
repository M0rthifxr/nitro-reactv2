{"ast":null,"code":"import{useEffect,useMemo,useRef,useState}from'react';import{AutoSizer,CellMeasurer,CellMeasurerCache,List}from'react-virtualized';import{AddEventLinkTracker,ChatEntryType,LocalizeText,RemoveLinkEventTracker}from'../../api';import{Flex,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../common';import{useChatHistory}from'../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const ChatHistoryView=props=>{const[isVisible,setIsVisible]=useState(false);const{chatHistory=[]}=useChatHistory();const elementRef=useRef(null);const cache=useMemo(()=>new CellMeasurerCache({defaultHeight:25,fixedWidth:true}),[]);const RowRenderer=props=>{const item=chatHistory[props.index];const isDark=props.index%2===0;return/*#__PURE__*/_jsx(CellMeasurer,{cache:cache,columnIndex:0,parent:props.parent,rowIndex:props.index,children:/*#__PURE__*/_jsxs(Flex,{style:props.style,className:\"p-1\",gap:1,children:[/*#__PURE__*/_jsx(Text,{variant:\"muted\",children:item.timestamp}),item.type===ChatEntryType.TYPE_CHAT&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{pointer:true,noWrap:true,dangerouslySetInnerHTML:{__html:item.name+':'}}),/*#__PURE__*/_jsx(Text,{textBreak:true,wrap:true,grow:true,children:item.message})]}),item.type===ChatEntryType.TYPE_ROOM_INFO&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"icon icon-small-room\"}),/*#__PURE__*/_jsx(Text,{textBreak:true,wrap:true,grow:true,children:item.name})]})]},props.key)},props.key);};const onResize=info=>cache.clearAll();useEffect(()=>{const linkTracker={linkReceived:url=>{const parts=url.split('/');if(parts.length<2)return;switch(parts[1]){case'show':setIsVisible(true);return;case'hide':setIsVisible(false);return;case'toggle':setIsVisible(prevValue=>!prevValue);return;}},eventUrlPrefix:'chat-history/'};AddEventLinkTracker(linkTracker);return()=>RemoveLinkEventTracker(linkTracker);},[]);useEffect(()=>{if(elementRef&&elementRef.current&&isVisible)elementRef.current.scrollToRow(-1);},[isVisible]);if(!isVisible)return null;return/*#__PURE__*/_jsxs(NitroCardView,{uniqueKey:\"chat-history\",className:\"nitro-chat-history\",theme:\"primary-slim\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('room.chathistory.button.text'),onCloseClick:event=>setIsVisible(false)}),/*#__PURE__*/_jsx(NitroCardContentView,{children:/*#__PURE__*/_jsx(AutoSizer,{defaultWidth:300,defaultHeight:200,onResize:onResize,children:_ref=>{let{height,width}=_ref;return/*#__PURE__*/_jsx(List,{ref:elementRef,width:width,height:height,rowCount:chatHistory.length,rowHeight:cache.rowHeight,className:'chat-history-list',rowRenderer:RowRenderer,deferredMeasurementCache:cache});}})})]});};","map":null,"metadata":{},"sourceType":"module"}